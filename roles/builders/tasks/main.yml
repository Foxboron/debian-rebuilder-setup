- name: Install all dependencies
  apt:
    name: "{{ item }}"
  with_items:
    - sbuild
    - libdatetime-format-strptime-perl
    - libwww-perl
    - libjson-perl
    - gnupg2
    - curl
    - python-pip

- name: Install in-toto
  pip:
    name: "{{ item }}"
  with_items:
    - in-toto
    - colorama

- name: Copy srebuild
  copy:
    src: ../../../builder/srebuild
    dest: /usr/bin/srebuild

- name: Copy srebuild-hook
  copy:
    src: ../../../builder/srebuild-hook
    dest: /usr/lib/srebuild-hook

- name: Copy template
  template:
    src: srebuild-runner.j2
    dest: /usr/bin/srebuild-runner

- name: Set permissions
  file:
    path: "{{ item }}"
    mode: 0755
  with_items:
    - /usr/bin/srebuild
    - /usr/bin/srebuild-runner
    - /usr/lib/srebuild-hook
